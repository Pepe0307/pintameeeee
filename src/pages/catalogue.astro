---
import BaseLayout from '../layouts/BaseLayout.astro';
import ProductCard from '../components/ProductCard.astro';
import { getCollection } from 'astro:content';

const allProducts = await getCollection('products');
const categories = [...new Set(allProducts.map(p => p.data.category))];
---

<BaseLayout 
  title="Catálogo" 
  description="Explora nuestro catálogo completo de arte. Encuentra pinturas, esculturas y más de talentosos artistas."
>
  <section class="py-16 px-4">
    <div class="container mx-auto">
      <!-- Header -->
      <div class="text-center mb-12">
        <h1 class="font-display text-5xl font-bold text-gallery-charcoal mb-4">
          Catálogo de Arte
        </h1>
        <p class="text-gray-600 max-w-2xl mx-auto">
          Explora nuestra colección completa de obras de arte únicas
        </p>
      </div>
      
      <!-- Filters -->
      <div class="flex flex-wrap justify-center gap-3 mb-12">
        <button 
          class="filter-btn active px-5 py-2 rounded-full border-2 border-gallery-charcoal 
                 bg-gallery-charcoal text-white transition-all"
          data-category="all"
        >
          Todos
        </button>
        {categories.map(category => (
          <button 
            class="filter-btn px-5 py-2 rounded-full border-2 border-gallery-charcoal 
                   text-gallery-charcoal hover:bg-gallery-charcoal hover:text-white transition-all capitalize"
            data-category={category}
          >
            {category}
          </button>
        ))}
      </div>
      
      <!-- Products Grid -->
      <div class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8" id="products-grid">
        {allProducts.map(product => (
          <div class="product-item" data-category={product.data.category}>
            <ProductCard 
              slug={product.id.replace('.json', '')}
              title={product.data.title}
              artist={product.data.artist}
              price={product.data.price}
              currency={product.data.currency}
              image={product.data.image}
              category={product.data.category}
              available={product.data.available}
            />
          </div>
        ))}
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  const filterBtns = document.querySelectorAll('.filter-btn');
  const productItems = document.querySelectorAll('.product-item');
  
  filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      // Update active state
      filterBtns.forEach(b => {
        b.classList.remove('active', 'bg-gallery-charcoal', 'text-white');
        b.classList.add('text-gallery-charcoal');
      });
      btn.classList.add('active', 'bg-gallery-charcoal', 'text-white');
      btn.classList.remove('text-gallery-charcoal');
      
      // Filter products
      const category = btn.getAttribute('data-category');
      
      productItems.forEach(item => {
        if (category === 'all' || item.getAttribute('data-category') === category) {
          item.style.display = 'block';
        } else {
          item.style.display = 'none';
        }
      });
    });
  });
</script>